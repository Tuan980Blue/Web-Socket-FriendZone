{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file://D%3A/Projects/WebSocket-Social/fe-websocket/src/hooks/useNotifications.ts"],"sourcesContent":["import { useState } from 'react';\r\nimport axios from 'axios';\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\r\n\r\nexport type NotificationType = 'LIKE' | 'COMMENT' | 'FOLLOW' | 'MENTION' | 'TAG' | 'STORY_VIEW' | 'STORY_REACTION';\r\n\r\ninterface Notification {\r\n    id: string;\r\n    type: NotificationType;\r\n    data: string;\r\n    isRead: boolean;\r\n    createdAt: string;\r\n}\r\n\r\ninterface NotificationData {\r\n    notifications: Notification[];\r\n    total: number;\r\n    page: number;\r\n    limit: number;\r\n    totalPages: number;\r\n}\r\n\r\nexport const useNotifications = () => {\r\n    const queryClient = useQueryClient();\r\n    const [page, setPage] = useState(1);\r\n    const limit = 20;\r\n\r\n    // Fetch notifications\r\n    const { data, isLoading } = useQuery({\r\n        queryKey: ['notifications', page],\r\n        queryFn: async () => {\r\n            const response = await axios.get(`/notifications?page=${page}&limit=${limit}`);\r\n            return response.data.data as NotificationData;\r\n        },\r\n    });\r\n\r\n    // Mark as read mutation\r\n    const markAsReadMutation = useMutation({\r\n        mutationFn: async (notificationId: string) => {\r\n            const response = await axios.put(`/notifications/${notificationId}/read`);\r\n            return response.data;\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: ['notifications'] });\r\n        },\r\n    });\r\n\r\n    // Get unread count\r\n    const { data: unreadCount } = useQuery({\r\n        queryKey: ['unreadCount'],\r\n        queryFn: async () => {\r\n            const response = await axios.get('/notifications/unread/count');\r\n            return response.data.data.count;\r\n        },\r\n    });\r\n\r\n    const handleMarkAsRead = async (notificationId: string) => {\r\n        try {\r\n            await markAsReadMutation.mutateAsync(notificationId);\r\n        } catch (error) {\r\n            console.error('Error marking notification as read:', error);\r\n        }\r\n    };\r\n\r\n    const handlePageChange = (newPage: number) => {\r\n        setPage(newPage);\r\n    };\r\n\r\n    return {\r\n        notifications: data?.notifications || [],\r\n        total: data?.total || 0,\r\n        page: data?.page || 1,\r\n        totalPages: data?.totalPages || 1,\r\n        unreadCount: unreadCount || 0,\r\n        isLoading,\r\n        handleMarkAsRead,\r\n        handlePageChange,\r\n    };\r\n}; "],"names":[],"mappings":";;;AAAA;AACA;AACA;AAAA;AAAA;;;;AAoBO,MAAM,mBAAmB;IAC5B,MAAM,cAAc,CAAA,GAAA,sLAAA,CAAA,iBAAc,AAAD;IACjC,MAAM,CAAC,MAAM,QAAQ,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACjC,MAAM,QAAQ;IAEd,sBAAsB;IACtB,MAAM,EAAE,IAAI,EAAE,SAAS,EAAE,GAAG,CAAA,GAAA,2KAAA,CAAA,WAAQ,AAAD,EAAE;QACjC,UAAU;YAAC;YAAiB;SAAK;QACjC,SAAS;YACL,MAAM,WAAW,MAAM,qIAAA,CAAA,UAAK,CAAC,GAAG,CAAC,CAAC,oBAAoB,EAAE,KAAK,OAAO,EAAE,OAAO;YAC7E,OAAO,SAAS,IAAI,CAAC,IAAI;QAC7B;IACJ;IAEA,wBAAwB;IACxB,MAAM,qBAAqB,CAAA,GAAA,8KAAA,CAAA,cAAW,AAAD,EAAE;QACnC,YAAY,OAAO;YACf,MAAM,WAAW,MAAM,qIAAA,CAAA,UAAK,CAAC,GAAG,CAAC,CAAC,eAAe,EAAE,eAAe,KAAK,CAAC;YACxE,OAAO,SAAS,IAAI;QACxB;QACA,WAAW;YACP,YAAY,iBAAiB,CAAC;gBAAE,UAAU;oBAAC;iBAAgB;YAAC;QAChE;IACJ;IAEA,mBAAmB;IACnB,MAAM,EAAE,MAAM,WAAW,EAAE,GAAG,CAAA,GAAA,2KAAA,CAAA,WAAQ,AAAD,EAAE;QACnC,UAAU;YAAC;SAAc;QACzB,SAAS;YACL,MAAM,WAAW,MAAM,qIAAA,CAAA,UAAK,CAAC,GAAG,CAAC;YACjC,OAAO,SAAS,IAAI,CAAC,IAAI,CAAC,KAAK;QACnC;IACJ;IAEA,MAAM,mBAAmB,OAAO;QAC5B,IAAI;YACA,MAAM,mBAAmB,WAAW,CAAC;QACzC,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,uCAAuC;QACzD;IACJ;IAEA,MAAM,mBAAmB,CAAC;QACtB,QAAQ;IACZ;IAEA,OAAO;QACH,eAAe,MAAM,iBAAiB,EAAE;QACxC,OAAO,MAAM,SAAS;QACtB,MAAM,MAAM,QAAQ;QACpB,YAAY,MAAM,cAAc;QAChC,aAAa,eAAe;QAC5B;QACA;QACA;IACJ;AACJ","debugId":null}},
    {"offset": {"line": 84, "column": 0}, "map": {"version":3,"sources":["file://D%3A/Projects/WebSocket-Social/fe-websocket/src/app/%28layout%29/notifications/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React from 'react';\r\nimport { useNotifications } from '@/hooks/useNotifications';\r\nimport {\r\n    Container,\r\n    Title,\r\n    Card,\r\n    Text,\r\n    Group,\r\n    Avatar,\r\n    Stack,\r\n    Skeleton,\r\n    Badge,\r\n    ActionIcon,\r\n    Tooltip,\r\n    Pagination,\r\n    Center,\r\n} from '@mantine/core';\r\nimport {\r\n    IconHeart,\r\n    IconMessageCircle,\r\n    IconUserPlus,\r\n    IconAt,\r\n    IconHash,\r\n    IconEye,\r\n    IconMoodSmile,\r\n    IconCheck,\r\n} from '@tabler/icons-react';\r\nimport { formatDistanceToNow } from 'date-fns';\r\nimport { vi } from 'date-fns/locale';\r\n\r\nconst getNotificationIcon = (type: string) => {\r\n    switch (type) {\r\n        case 'LIKE':\r\n            return <IconHeart size={20} color=\"red\" />;\r\n        case 'COMMENT':\r\n            return <IconMessageCircle size={20} color=\"blue\" />;\r\n        case 'FOLLOW':\r\n            return <IconUserPlus size={20} color=\"green\" />;\r\n        case 'MENTION':\r\n            return <IconAt size={20} color=\"purple\" />;\r\n        case 'TAG':\r\n            return <IconHash size={20} color=\"orange\" />;\r\n        case 'STORY_VIEW':\r\n            return <IconEye size={20} color=\"cyan\" />;\r\n        case 'STORY_REACTION':\r\n            return <IconMoodSmile size={20} color=\"yellow\" />;\r\n        default:\r\n            return null;\r\n    }\r\n};\r\n\r\nconst getNotificationColor = (type: string) => {\r\n    switch (type) {\r\n        case 'LIKE':\r\n            return 'red';\r\n        case 'COMMENT':\r\n            return 'blue';\r\n        case 'FOLLOW':\r\n            return 'green';\r\n        case 'MENTION':\r\n            return 'purple';\r\n        case 'TAG':\r\n            return 'orange';\r\n        case 'STORY_VIEW':\r\n            return 'cyan';\r\n        case 'STORY_REACTION':\r\n            return 'yellow';\r\n        default:\r\n            return 'gray';\r\n    }\r\n};\r\n\r\nconst NotificationCard = ({ notification, onMarkAsRead }: any) => {\r\n    const data = JSON.parse(notification.data);\r\n\r\n    return (\r\n        <Card\r\n            withBorder\r\n            padding=\"lg\"\r\n            radius=\"md\"\r\n            style={{\r\n                opacity: notification.isRead ? 0.7 : 1,\r\n            }}\r\n        >\r\n            <Group justify=\"space-between\" align=\"flex-start\">\r\n                <Group gap=\"sm\">\r\n                    <Avatar\r\n                        src={data.actorAvatar}\r\n                        alt={data.actorName}\r\n                        size=\"md\"\r\n                        radius=\"xl\"\r\n                    />\r\n                    <div>\r\n                        <Text size=\"sm\" lineClamp={2}>\r\n                            <Text component=\"span\" fw={500}>\r\n                                {data.actorName}\r\n                            </Text>{' '}\r\n                            {data.message}\r\n                        </Text>\r\n                        <Group gap=\"xs\" mt=\"xs\">\r\n                            <Badge\r\n                                variant=\"light\"\r\n                                color={getNotificationColor(notification.type)}\r\n                            >\r\n                                {getNotificationIcon(notification.type)}\r\n                            </Badge>\r\n                            <Text size=\"xs\" c=\"dimmed\">\r\n                                {formatDistanceToNow(\r\n                                    new Date(notification.createdAt),\r\n                                    {\r\n                                        addSuffix: true,\r\n                                        locale: vi,\r\n                                    }\r\n                                )}\r\n                            </Text>\r\n                        </Group>\r\n                    </div>\r\n                </Group>\r\n                {!notification.isRead && (\r\n                    <Tooltip label=\"Đánh dấu đã đọc\" position=\"left\">\r\n                        <ActionIcon\r\n                            variant=\"light\"\r\n                            color=\"blue\"\r\n                            size=\"lg\"\r\n                            radius=\"xl\"\r\n                            onClick={() => onMarkAsRead(notification.id)}\r\n                        >\r\n                            <IconCheck size={20} />\r\n                        </ActionIcon>\r\n                    </Tooltip>\r\n                )}\r\n            </Group>\r\n        </Card>\r\n    );\r\n};\r\n\r\nconst LoadingSkeleton = () => (\r\n    <Stack gap=\"md\">\r\n        {[1, 2, 3].map((i) => (\r\n            <Card withBorder padding=\"lg\" radius=\"md\" key={i}>\r\n                <Group gap=\"sm\">\r\n                    <Skeleton height={40} circle />\r\n                    <div style={{ flex: 1 }}>\r\n                        <Skeleton height={20} width=\"80%\" mb=\"xs\" />\r\n                        <Skeleton height={15} width=\"40%\" />\r\n                    </div>\r\n                </Group>\r\n            </Card>\r\n        ))}\r\n    </Stack>\r\n);\r\n\r\nconst NotificationsPage = () => {\r\n    const {\r\n        notifications,\r\n        total,\r\n        page,\r\n        totalPages,\r\n        unreadCount,\r\n        isLoading,\r\n        handleMarkAsRead,\r\n        handlePageChange,\r\n    } = useNotifications();\r\n\r\n    return (\r\n        <Container size=\"md\" py=\"xl\">\r\n            <Group justify=\"space-between\" mb=\"xl\">\r\n                <Title order={2}>Thông báo</Title>\r\n                {unreadCount > 0 && (\r\n                    <Badge size=\"lg\" variant=\"filled\" color=\"blue\">\r\n                        {unreadCount} chưa đọc\r\n                    </Badge>\r\n                )}\r\n            </Group>\r\n\r\n            {isLoading ? (\r\n                <LoadingSkeleton />\r\n            ) : (\r\n                <>\r\n                    <Stack gap=\"md\" mb=\"xl\">\r\n                        {notifications.map((notification) => (\r\n                            <NotificationCard\r\n                                key={notification.id}\r\n                                notification={notification}\r\n                                onMarkAsRead={handleMarkAsRead}\r\n                            />\r\n                        ))}\r\n                        {notifications.length === 0 && (\r\n                            <Text c=\"dimmed\" ta=\"center\" py=\"xl\">\r\n                                Chưa có thông báo nào\r\n                            </Text>\r\n                        )}\r\n                    </Stack>\r\n\r\n                    {totalPages > 1 && (\r\n                        <Center>\r\n                            <Pagination\r\n                                value={page}\r\n                                onChange={handlePageChange}\r\n                                total={totalPages}\r\n                                withEdges\r\n                            />\r\n                        </Center>\r\n                    )}\r\n                </>\r\n            )}\r\n        </Container>\r\n    );\r\n};\r\n\r\nexport default NotificationsPage;"],"names":[],"mappings":"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","debugId":null}}]
}